# =============================================================================
# Project Configuration
# =============================================================================
# Prerequisites:
# 1. Project must already exist in GCP
# 2. Required APIs should be enabled (this module will attempt to enable them)
# 3. Service account running Terraform must have necessary permissions
project_id = "pexip-infinity-project"
network_name = "pexip-infinity-vpc"  # Must already exist

# =============================================================================
# Region Configuration
# =============================================================================

# Define regions and their network configurations
# The first region in the list will be used as the primary region for management node deployment

# Example for single region:
regions = [
  {
    region      = "us-central1"
    network     = "pexip-vpc-us"
    subnet_name = "subnet-central"
  }
]

# Example for multiple regions:
# regions = [
#   {
#     region      = "us-central1"     # Primary region (first in list)
#     network     = "pexip-vpc-us"    # Can use same or different VPCs per region
#     subnet_name = "subnet-central"
#   },
#   {
#     region      = "us-east1"
#     network     = "pexip-vpc-us"    # Reusing same VPC as us-central1
#     subnet_name = "subnet-east"
#   },
#   {
#     region      = "europe-west1"
#     network     = "pexip-vpc-eu"    # Using different VPC for EU
#     subnet_name = "subnet-europe"
#   }
# ]

# =============================================================================
# Management Access Configuration
# =============================================================================
management_access = {
  cidr_ranges = ["0.0.0.0/0"]  # Restrict management access
}

# =============================================================================
# Service Configuration
# =============================================================================
services = {
  # Management services
  enable_ssh               = true
  enable_conf_provisioning = true

  # Call services (inbound)
  enable_sip   = true
  enable_h323  = true
  enable_teams = true
  enable_gmeet = true

  # Optional services
  enable_teams_hub = false
  enable_syslog    = false
  enable_smtp      = false
  enable_ldap      = false
}

# =============================================================================
# Pexip Images
# =============================================================================
# Example 1: Upload local files and create images (typical first-time deployment)
pexip_images = {
  upload_files = true
  management = {
    source_file = "/path/to/files/Pexip_Infinity_Management_Node.tar.gz"
    image_name  = "pexip-infinity-management"
  }
  conferencing = {
    source_file = "/path/to/files/Pexip_Infinity_Conferencing_Node.tar.gz"
    image_name  = "pexip-infinity-conferencing"  # Used for both transcoding and proxy nodes
  }
}

# Example 2: Use existing images
# pexip_images = {
#   upload_files = false
#   management = {
#     image_name = "pexip-infinity-management"
#   }
#   conferencing = {
#     image_name = "pexip-infinity-conferencing"  # Used for both transcoding and proxy nodes
#   }
# }

# =============================================================================
# Management Node Configuration
# =============================================================================
management_node = {
  name      = "pexip-mgmt"
  region    = "us-central1"
  public_ip = true
}

# =============================================================================
# Transcoding Node Configuration
# =============================================================================
transcoding_nodes = {
  regional_config = {
    "us-central1" = {
      count        = 2
      public_ip    = true
      name         = "pexip-transcoding"
      machine_type = "n2-highcpu-8"
    }
  }
}

# Example for multiple regions:
# transcoding_nodes = {
#   regional_config = {
#     "us-central1" = {
#       count        = 2
#       public_ip    = true
#       name         = "pexip-transcoding"
#       machine_type = "n2-highcpu-8"
#     }
#     "us-east1" = {
#       count        = 2
#       public_ip    = true
#       name         = "pexip-transcoding-east"
#       machine_type = "n2-highcpu-4"  # Different size for lower traffic region
#     }
#   }
# }

# =============================================================================
# Proxy Node Configuration
# =============================================================================
# Proxy nodes are optional and NOT recommended for cloud deployments
# Only deploy if specifically required by your architecture
proxy_nodes = {
  regional_config = {
    "us-central1" = {
      count        = 1
      public_ip    = true
      name         = "pexip-proxy"
      machine_type = "n2-highcpu-4"
    }
  }
}
